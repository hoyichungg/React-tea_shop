{"ast":null,"code":"var _jsxFileName = \"/Users/gua/Desktop/tea-shop/src/components/flavor/FlavorChart.jsx\";\nimport React, { useEffect } from 'react';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { selectByFlavor } from 'actions/flavor';\nimport * as d3 from 'd3';\n\nfunction drawChart(data, targets, onClick) {\n  const full = (len, el) => {\n    let newArray = [];\n\n    for (let i = 0; i < len; i++) {\n      newArray.push(el);\n    }\n\n    return newArray;\n  };\n\n  const svg = d3.select('#flavorChart');\n  const svgBox = svg.node().getBoundingClientRect();\n  const width = (svgBox.width - 40) / 2;\n  const radius = [width * 0.2, width * 0.58 - 1, width * 0.58, width];\n  const svgSize = {\n    width: radius[3] * 2,\n    height: radius[3] * 2\n  };\n  const center = {\n    x: radius[3] + 20,\n    y: radius[3] + 20\n  };\n  const colors = ['#F3F3B8', '#EFA593', '#EBDCD1', '#F7DFE3', '#A08E8E', '#A2A0A0', '#A4C56D']; // const innerWidth = data.map(el => el.outerflavors.length)\n\n  d3.select('#innerPie').remove();\n  svg.append('g').attr('id', 'innerPie');\n  svg.attr('width', svgSize.width).attr('height', svgSize.height + 40);\n  data.sort((a, b) => a.sortOrder - b.sortOrder);\n  const innerPies = d3.pie().sort((a, b) => a.sortOrder - b.sortOrder).value(d => d.outerflavors.length)(data);\n  const innerData = data.map((el, i) => {\n    return { ...el,\n      ...innerPies[i],\n      color: colors[i]\n    };\n  }); // calculation of pie\n\n  const innerArc = d3.arc().innerRadius(radius[0]).outerRadius(radius[1]).padAngle(Math.PI / 360);\n  const outerArc = d3.arc().innerRadius(radius[2]).outerRadius(radius[3]).padAngle(Math.PI / 720);\n\n  const drawCircleOutOfArc = arc => sel => d => {\n    const innerRadius = arc.outerRadius()();\n    const circleArc = d3.arc().innerRadius(innerRadius).outerRadius(innerRadius + 30);\n    const centroid = circleArc.centroid(d);\n    sel.append('circle').attr('cx', centroid[0]).attr('cy', centroid[1]).attr('r', 5);\n  };\n\n  const drawTextOnCentroid = arc => sel => d => sel.append('text').text(d => d.name).each(function (d) {\n    const currentNode = d3.select(this);\n    const centroid = arc.centroid(d);\n    const x = centroid[0];\n    const y = centroid[1];\n    const width = currentNode.node().getBBox().width;\n    const height = currentNode.node().getBBox().height;\n    const angle = (d.startAngle + d.endAngle) / 2 * 360 / (2 * Math.PI) + 90;\n    currentNode.attr('x', x - width / 2).attr('y', y + height / 4).attr('fill', '#555').attr('class', 'text').call(sel => {\n      if (angle > 90 && angle < 270) {\n        sel.attr('transform', `rotate(${angle + 180}, ${x}, ${y})`);\n      } else {\n        sel.attr('transform', `rotate(${angle}, ${x}, ${y})`);\n      }\n    });\n  }); // inner pie\n\n\n  svg.select('#innerPie').attr('transform', `translate(${center.x},${center.y})`).selectAll('g').data(innerData).enter().append('g').each(function (d) {\n    const innerGroup = d3.select(this);\n    innerGroup.append('path').datum(d).attr('d', d => innerArc(d)).attr('class', 'inner').attr('fill', d => d.color).each(function (d) {\n      drawTextOnCentroid(innerArc)(innerGroup)(d).style('font-size', '18px').style('opacity', '.8');\n      const outerPies = d3.pie().startAngle(d.startAngle).endAngle(d.endAngle)(full(d.outerflavors.length, 1));\n      const outerData = d.outerflavors.map((el, i) => {\n        return { ...el,\n          ...outerPies[i],\n          color: d.color\n        };\n      });\n      const outerGroup = innerGroup.selectAll('.outer').data(outerData).enter().append('g').attr('class', 'outer flavor-link'); // outer Click\n\n      outerGroup.on('click', function (d, i, nodes) {\n        onClick(d.id);\n      }).filter(d => {\n        for (const key in targets) {\n          if (d.id === targets[key]) {\n            return true;\n          }\n        }\n      }).attr('class', 'active').each(function (d) {\n        d3.select(this).call(sel => drawCircleOutOfArc(outerArc)(sel)(d));\n      });\n      outerGroup.append('path').attr('d', d => outerArc(d)).attr('fill', d => d.color);\n      drawTextOnCentroid(outerArc)(outerGroup)(d).style('font-size', '14px');\n    });\n  });\n}\n\nfunction FlavorChart({\n  flavors,\n  targetTeaFlavors,\n  selectedFlavor,\n  selectByFlavor\n}) {\n  const targetFlavors = {};\n\n  if (targetTeaFlavors.length === 1) {\n    targetFlavors.frontId = targetTeaFlavors[0].frontId;\n    targetFlavors.midId = targetTeaFlavors[0].midId;\n    targetFlavors.endId = targetTeaFlavors[0].endId;\n  } else if (targetTeaFlavors.length > 1) {\n    targetFlavors.frontId = selectedFlavor;\n  }\n\n  useEffect(() => {\n    if (flavors) {\n      drawChart(flavors, targetFlavors, selectByFlavor);\n    }\n  }, [flavors, targetFlavors]);\n  return /*#__PURE__*/React.createElement(\"svg\", {\n    id: \"flavorChart\",\n    className: \"flavor w-100\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"g\", {\n    id: \"innerPie\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 7\n    }\n  }));\n}\n\nconst mapStateToProps = ({\n  flavor\n}) => {\n  return { ...flavor\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return bindActionCreators({\n    selectByFlavor\n  }, dispatch);\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(FlavorChart);","map":{"version":3,"sources":["/Users/gua/Desktop/tea-shop/src/components/flavor/FlavorChart.jsx"],"names":["React","useEffect","connect","bindActionCreators","selectByFlavor","d3","drawChart","data","targets","onClick","full","len","el","newArray","i","push","svg","select","svgBox","node","getBoundingClientRect","width","radius","svgSize","height","center","x","y","colors","remove","append","attr","sort","a","b","sortOrder","innerPies","pie","value","d","outerflavors","length","innerData","map","color","innerArc","arc","innerRadius","outerRadius","padAngle","Math","PI","outerArc","drawCircleOutOfArc","sel","circleArc","centroid","drawTextOnCentroid","text","name","each","currentNode","getBBox","angle","startAngle","endAngle","call","selectAll","enter","innerGroup","datum","style","outerPies","outerData","outerGroup","on","nodes","id","filter","key","FlavorChart","flavors","targetTeaFlavors","selectedFlavor","targetFlavors","frontId","midId","endId","mapStateToProps","flavor","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\nimport { selectByFlavor } from 'actions/flavor'\nimport * as d3 from 'd3'\n\nfunction drawChart(data, targets, onClick) {\n  const full = (len, el) => {\n    let newArray = []\n    for (let i = 0; i < len; i++) {\n      newArray.push(el)\n    }\n    return newArray\n  }\n\n  const svg = d3.select('#flavorChart')\n  const svgBox = svg.node().getBoundingClientRect()\n  const width = (svgBox.width - 40) / 2\n  const radius = [width * 0.2, width * 0.58 - 1, width * 0.58, width]\n\n  const svgSize = {\n    width: radius[3] * 2,\n    height: radius[3] * 2,\n  }\n  const center = {\n    x: radius[3] + 20,\n    y: radius[3] + 20,\n  }\n  const colors = [\n    '#F3F3B8',\n    '#EFA593',\n    '#EBDCD1',\n    '#F7DFE3',\n    '#A08E8E',\n    '#A2A0A0',\n    '#A4C56D',\n  ]\n  // const innerWidth = data.map(el => el.outerflavors.length)\n  d3.select('#innerPie').remove()\n  svg.append('g').attr('id', 'innerPie')\n  svg.attr('width', svgSize.width).attr('height', svgSize.height + 40)\n\n  data.sort((a, b) => a.sortOrder - b.sortOrder)\n\n  const innerPies = d3\n    .pie()\n    .sort((a, b) => a.sortOrder - b.sortOrder)\n    .value(d => d.outerflavors.length)(data)\n\n  const innerData = data.map((el, i) => {\n    return {\n      ...el,\n      ...innerPies[i],\n      color: colors[i],\n    }\n  })\n\n  // calculation of pie\n  const innerArc = d3\n    .arc()\n    .innerRadius(radius[0])\n    .outerRadius(radius[1])\n    .padAngle(Math.PI / 360)\n\n  const outerArc = d3\n    .arc()\n    .innerRadius(radius[2])\n    .outerRadius(radius[3])\n    .padAngle(Math.PI / 720)\n\n  const drawCircleOutOfArc = arc => sel => d => {\n    const innerRadius = arc.outerRadius()()\n    const circleArc = d3\n      .arc()\n      .innerRadius(innerRadius)\n      .outerRadius(innerRadius + 30)\n    const centroid = circleArc.centroid(d)\n    sel\n      .append('circle')\n      .attr('cx', centroid[0])\n      .attr('cy', centroid[1])\n      .attr('r', 5)\n  }\n\n  const drawTextOnCentroid = arc => sel => d =>\n    sel\n      .append('text')\n      .text(d => d.name)\n      .each(function(d) {\n        const currentNode = d3.select(this)\n        const centroid = arc.centroid(d)\n        const x = centroid[0]\n        const y = centroid[1]\n        const width = currentNode.node().getBBox().width\n        const height = currentNode.node().getBBox().height\n        const angle =\n          (((d.startAngle + d.endAngle) / 2) * 360) / (2 * Math.PI) + 90\n        currentNode\n          .attr('x', x - width / 2)\n          .attr('y', y + height / 4)\n          .attr('fill', '#555')\n          .attr('class', 'text')\n          .call(sel => {\n            if (angle > 90 && angle < 270) {\n              sel.attr('transform', `rotate(${angle + 180}, ${x}, ${y})`)\n            } else {\n              sel.attr('transform', `rotate(${angle}, ${x}, ${y})`)\n            }\n          })\n      })\n\n  // inner pie\n  svg\n    .select('#innerPie')\n    .attr('transform', `translate(${center.x},${center.y})`)\n    .selectAll('g')\n    .data(innerData)\n    .enter()\n    .append('g')\n    .each(function(d) {\n      const innerGroup = d3.select(this)\n      innerGroup\n        .append('path')\n        .datum(d)\n        .attr('d', d => innerArc(d))\n        .attr('class', 'inner')\n        .attr('fill', d => d.color)\n        .each(function(d) {\n          drawTextOnCentroid(innerArc)(innerGroup)(d)\n            .style('font-size', '18px')\n            .style('opacity', '.8')\n          const outerPies = d3\n            .pie()\n            .startAngle(d.startAngle)\n            .endAngle(d.endAngle)(full(d.outerflavors.length, 1))\n          const outerData = d.outerflavors.map((el, i) => {\n            return {\n              ...el,\n              ...outerPies[i],\n              color: d.color,\n            }\n          })\n          const outerGroup = innerGroup\n            .selectAll('.outer')\n            .data(outerData)\n            .enter()\n            .append('g')\n            .attr('class', 'outer flavor-link')\n\n          // outer Click\n          outerGroup\n            .on('click', function(d, i, nodes) {\n              onClick(d.id)\n            })\n            .filter((d) => {\n              for (const key in targets) {\n                if (d.id === targets[key]) {\n                  return true\n                }\n              }\n            })\n            .attr('class', 'active')\n            .each(function(d) {\n              d3.select(this).call(sel => drawCircleOutOfArc(outerArc)(sel)(d))\n            })\n          outerGroup\n            .append('path')\n            .attr('d', d => outerArc(d))\n            .attr('fill', d => d.color)\n\n          drawTextOnCentroid(outerArc)(outerGroup)(d).style('font-size', '14px')\n        })\n    })\n}\n\nfunction FlavorChart({ flavors, targetTeaFlavors, selectedFlavor, selectByFlavor }) {\n  const targetFlavors = {}\n  if (targetTeaFlavors.length === 1) {\n    targetFlavors.frontId = targetTeaFlavors[0].frontId\n    targetFlavors.midId = targetTeaFlavors[0].midId\n    targetFlavors.endId = targetTeaFlavors[0].endId\n  } else if (targetTeaFlavors.length > 1 ) {\n    targetFlavors.frontId = selectedFlavor\n  }\n  useEffect(() => {\n    if (flavors) {\n      drawChart(flavors, targetFlavors, selectByFlavor)\n    }\n  }, [flavors, targetFlavors])\n  return (\n    <svg id=\"flavorChart\" className=\"flavor w-100\">\n      <g id=\"innerPie\"></g>\n    </svg>\n  )\n}\n\nconst mapStateToProps = ({ flavor }) => {\n  return { ...flavor }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return bindActionCreators({ selectByFlavor }, dispatch)\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(FlavorChart)\n"]},"metadata":{},"sourceType":"module"}