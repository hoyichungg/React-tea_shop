{"ast":null,"code":"import _objectWithoutProperties from 'babel-runtime/helpers/objectWithoutProperties';\nimport _extends from 'babel-runtime/helpers/extends';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _inherits from 'babel-runtime/helpers/inherits';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport { Tween } from 'rc-tween-one';\nimport { stylesToCss } from 'style-utils';\nimport { currentScrollTop, toArrayChildren, windowHeight } from './utils';\nimport animType from './anim';\n\nvar BgElement = function (_React$Component) {\n  _inherits(BgElement, _React$Component);\n\n  _createClass(BgElement, null, [{\n    key: 'getDerivedStateFromProps',\n    value: function getDerivedStateFromProps(props, _ref) {\n      var prevProps = _ref.prevProps,\n          $self = _ref.$self;\n      var nextState = {\n        prevProps: props\n      };\n\n      if (prevProps && props !== prevProps) {\n        if (props.show) {\n          // 取 dom 在 render 之后；\n          setTimeout(function () {\n            if ($self.video && prevProps.videoResize && $self.videoLoad) {\n              $self.onResize();\n            }\n\n            if (prevProps.scrollParallax) {\n              $self.onScroll();\n            }\n          });\n        }\n      }\n\n      return nextState;\n    }\n  }]);\n\n  function BgElement(props) {\n    _classCallCheck(this, BgElement);\n\n    var _this = _possibleConstructorReturn(this, (BgElement.__proto__ || Object.getPrototypeOf(BgElement)).call(this, props));\n\n    _this.onScroll = function () {\n      var scrollTop = currentScrollTop();\n\n      var domRect = _this.dom.parentNode.getBoundingClientRect();\n\n      var offsetTop = domRect.top + scrollTop;\n      var height = Math.max(domRect.height, windowHeight());\n      var elementShowHeight = scrollTop - offsetTop + height;\n      var scale = elementShowHeight / (height + domRect.height);\n      scale = scale || 0;\n      scale = scale >= 1 ? 1 : scale;\n\n      _this.tween.frame(scale * _this.scrollParallaxDuration);\n    };\n\n    _this.onResize = function () {\n      if (!_this.props.show) {\n        return;\n      }\n\n      var domRect = _this.dom.getBoundingClientRect();\n\n      var videoDomRect = _this.video.getBoundingClientRect();\n\n      _this.videoLoad = true;\n      var scale = void 0;\n      var videoRect = {\n        display: 'block',\n        position: 'relative',\n        top: 0,\n        left: 0\n      };\n\n      if (domRect.width / domRect.height > videoDomRect.width / videoDomRect.height) {\n        scale = domRect.width / videoDomRect.width;\n        videoRect.width = domRect.width;\n        videoRect.height = videoDomRect.height * scale;\n        videoRect.top = -(videoRect.height - domRect.height) / 2;\n      } else {\n        scale = domRect.height / videoDomRect.height;\n        videoRect.height = domRect.height;\n        videoRect.width = videoDomRect.width * scale;\n        videoRect.left = -(videoRect.width - domRect.width) / 2;\n      }\n\n      Object.keys(videoRect).forEach(function (key) {\n        _this.video.style[key] = stylesToCss(key, videoRect[key]);\n      });\n    };\n\n    _this.videoLoadedData = function () {\n      _this.onResize();\n\n      if (window.addEventListener) {\n        window.addEventListener('resize', _this.onResize);\n      } else {\n        window.attachEvent('onresize', _this.onResize);\n      }\n    };\n\n    _this.isVideo = toArrayChildren(props.children).some(function (item) {\n      return item.type === 'video';\n    });\n\n    if (_this.isVideo) {\n      // 如果是 video，删除 grid 系列，位置发生变化，重加载了 video;\n      delete animType.grid;\n      delete animType.gridBar;\n    }\n\n    if (props.scrollParallax) {\n      _this.scrollParallaxDuration = props.scrollParallax.duration || 450;\n    }\n\n    _this.video = null;\n    _this.videoLoad = false;\n    _this.state = {\n      $self: _this\n    };\n    return _this;\n  }\n\n  _createClass(BgElement, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.dom = ReactDOM.findDOMNode(this);\n\n      if (!this.videoLoad) {\n        if (this.video && this.props.videoResize) {\n          this.video.onloadeddata = this.videoLoadedData;\n        }\n      }\n\n      if (this.props.scrollParallax) {\n        this.tween = new Tween(this.dom, [_extends({\n          ease: 'linear'\n        }, this.props.scrollParallax)]);\n        this.tween.init();\n        this.onScroll();\n\n        if (window.addEventListener) {\n          window.addEventListener('scroll', this.onScroll);\n        } else {\n          window.attachEvent('onscroll', this.onScroll);\n        }\n      }\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      if (window.addEventListener) {\n        window.removeEventListener('resize', this.onResize);\n        window.removeEventListener('scroll', this.onScroll);\n      } else {\n        window.detachEvent('onresize', this.onResize);\n        window.detachEvent('onscroll', this.onScroll);\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this2 = this;\n\n      var _props = this.props,\n          videoResize = _props.videoResize,\n          scrollParallax = _props.scrollParallax,\n          show = _props.show,\n          component = _props.component,\n          componentProps = _props.componentProps,\n          props = _objectWithoutProperties(_props, ['videoResize', 'scrollParallax', 'show', 'component', 'componentProps']);\n\n      if (this.isVideo && videoResize) {\n        var children = toArrayChildren(props.children).map(function (item, i) {\n          return React.cloneElement(item, _extends({}, item.props, {\n            key: item.key || 'bg-video-' + i,\n            ref: function ref(c) {\n              _this2.video = c;\n\n              if (typeof item.ref === 'function') {\n                item.ref(c);\n              }\n            }\n          }));\n        });\n        props.children = children.length === 1 ? children[0] : children;\n      }\n\n      return React.createElement(this.props.component, _extends({}, props, componentProps));\n    }\n  }]);\n\n  return BgElement;\n}(React.Component);\n\nexport default BgElement;\nBgElement.propTypes = {\n  className: PropTypes.string,\n  style: PropTypes.object,\n  children: PropTypes.any,\n  component: PropTypes.any,\n  videoResize: PropTypes.bool,\n  scrollParallax: PropTypes.object,\n  show: PropTypes.bool,\n  componentProps: PropTypes.object\n};\nBgElement.defaultProps = {\n  component: 'div',\n  videoResize: true,\n  componentProps: {}\n};\nBgElement.isBannerAnimBgElement = true;","map":{"version":3,"sources":["/Users/gua/Desktop/tea-shop/node_modules/rc-banner-anim/es/BgElement.js"],"names":["_objectWithoutProperties","_extends","_classCallCheck","_possibleConstructorReturn","_createClass","_inherits","React","ReactDOM","PropTypes","Tween","stylesToCss","currentScrollTop","toArrayChildren","windowHeight","animType","BgElement","_React$Component","key","value","getDerivedStateFromProps","props","_ref","prevProps","$self","nextState","show","setTimeout","video","videoResize","videoLoad","onResize","scrollParallax","onScroll","_this","__proto__","Object","getPrototypeOf","call","scrollTop","domRect","dom","parentNode","getBoundingClientRect","offsetTop","top","height","Math","max","elementShowHeight","scale","tween","frame","scrollParallaxDuration","videoDomRect","videoRect","display","position","left","width","keys","forEach","style","videoLoadedData","window","addEventListener","attachEvent","isVideo","children","some","item","type","grid","gridBar","duration","state","componentDidMount","findDOMNode","onloadeddata","ease","init","componentWillUnmount","removeEventListener","detachEvent","render","_this2","_props","component","componentProps","map","i","cloneElement","ref","c","length","createElement","Component","propTypes","className","string","object","any","bool","defaultProps","isBannerAnimBgElement"],"mappings":"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","sourcesContent":["import _objectWithoutProperties from 'babel-runtime/helpers/objectWithoutProperties';\nimport _extends from 'babel-runtime/helpers/extends';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _inherits from 'babel-runtime/helpers/inherits';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport { Tween } from 'rc-tween-one';\nimport { stylesToCss } from 'style-utils';\nimport { currentScrollTop, toArrayChildren, windowHeight } from './utils';\nimport animType from './anim';\n\nvar BgElement = function (_React$Component) {\n  _inherits(BgElement, _React$Component);\n\n  _createClass(BgElement, null, [{\n    key: 'getDerivedStateFromProps',\n    value: function getDerivedStateFromProps(props, _ref) {\n      var prevProps = _ref.prevProps,\n          $self = _ref.$self;\n\n      var nextState = {\n        prevProps: props\n      };\n      if (prevProps && props !== prevProps) {\n        if (props.show) {\n          // 取 dom 在 render 之后；\n          setTimeout(function () {\n            if ($self.video && prevProps.videoResize && $self.videoLoad) {\n              $self.onResize();\n            }\n            if (prevProps.scrollParallax) {\n              $self.onScroll();\n            }\n          });\n        }\n      }\n      return nextState;\n    }\n  }]);\n\n  function BgElement(props) {\n    _classCallCheck(this, BgElement);\n\n    var _this = _possibleConstructorReturn(this, (BgElement.__proto__ || Object.getPrototypeOf(BgElement)).call(this, props));\n\n    _this.onScroll = function () {\n      var scrollTop = currentScrollTop();\n      var domRect = _this.dom.parentNode.getBoundingClientRect();\n      var offsetTop = domRect.top + scrollTop;\n      var height = Math.max(domRect.height, windowHeight());\n      var elementShowHeight = scrollTop - offsetTop + height;\n      var scale = elementShowHeight / (height + domRect.height);\n      scale = scale || 0;\n      scale = scale >= 1 ? 1 : scale;\n      _this.tween.frame(scale * _this.scrollParallaxDuration);\n    };\n\n    _this.onResize = function () {\n      if (!_this.props.show) {\n        return;\n      }\n      var domRect = _this.dom.getBoundingClientRect();\n      var videoDomRect = _this.video.getBoundingClientRect();\n      _this.videoLoad = true;\n      var scale = void 0;\n      var videoRect = {\n        display: 'block',\n        position: 'relative',\n        top: 0,\n        left: 0\n      };\n      if (domRect.width / domRect.height > videoDomRect.width / videoDomRect.height) {\n        scale = domRect.width / videoDomRect.width;\n        videoRect.width = domRect.width;\n        videoRect.height = videoDomRect.height * scale;\n        videoRect.top = -(videoRect.height - domRect.height) / 2;\n      } else {\n        scale = domRect.height / videoDomRect.height;\n        videoRect.height = domRect.height;\n        videoRect.width = videoDomRect.width * scale;\n        videoRect.left = -(videoRect.width - domRect.width) / 2;\n      }\n\n      Object.keys(videoRect).forEach(function (key) {\n        _this.video.style[key] = stylesToCss(key, videoRect[key]);\n      });\n    };\n\n    _this.videoLoadedData = function () {\n      _this.onResize();\n      if (window.addEventListener) {\n        window.addEventListener('resize', _this.onResize);\n      } else {\n        window.attachEvent('onresize', _this.onResize);\n      }\n    };\n\n    _this.isVideo = toArrayChildren(props.children).some(function (item) {\n      return item.type === 'video';\n    });\n    if (_this.isVideo) {\n      // 如果是 video，删除 grid 系列，位置发生变化，重加载了 video;\n      delete animType.grid;\n      delete animType.gridBar;\n    }\n    if (props.scrollParallax) {\n      _this.scrollParallaxDuration = props.scrollParallax.duration || 450;\n    }\n    _this.video = null;\n    _this.videoLoad = false;\n    _this.state = {\n      $self: _this\n    };\n    return _this;\n  }\n\n  _createClass(BgElement, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.dom = ReactDOM.findDOMNode(this);\n      if (!this.videoLoad) {\n        if (this.video && this.props.videoResize) {\n          this.video.onloadeddata = this.videoLoadedData;\n        }\n      }\n      if (this.props.scrollParallax) {\n        this.tween = new Tween(this.dom, [_extends({\n          ease: 'linear' }, this.props.scrollParallax)]);\n        this.tween.init();\n        this.onScroll();\n        if (window.addEventListener) {\n          window.addEventListener('scroll', this.onScroll);\n        } else {\n          window.attachEvent('onscroll', this.onScroll);\n        }\n      }\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      if (window.addEventListener) {\n        window.removeEventListener('resize', this.onResize);\n        window.removeEventListener('scroll', this.onScroll);\n      } else {\n        window.detachEvent('onresize', this.onResize);\n        window.detachEvent('onscroll', this.onScroll);\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this2 = this;\n\n      var _props = this.props,\n          videoResize = _props.videoResize,\n          scrollParallax = _props.scrollParallax,\n          show = _props.show,\n          component = _props.component,\n          componentProps = _props.componentProps,\n          props = _objectWithoutProperties(_props, ['videoResize', 'scrollParallax', 'show', 'component', 'componentProps']);\n\n      if (this.isVideo && videoResize) {\n        var children = toArrayChildren(props.children).map(function (item, i) {\n          return React.cloneElement(item, _extends({}, item.props, { key: item.key || 'bg-video-' + i, ref: function ref(c) {\n              _this2.video = c;\n              if (typeof item.ref === 'function') {\n                item.ref(c);\n              }\n            }\n          }));\n        });\n        props.children = children.length === 1 ? children[0] : children;\n      }\n      return React.createElement(this.props.component, _extends({}, props, componentProps));\n    }\n  }]);\n\n  return BgElement;\n}(React.Component);\n\nexport default BgElement;\n\n\nBgElement.propTypes = {\n  className: PropTypes.string,\n  style: PropTypes.object,\n  children: PropTypes.any,\n  component: PropTypes.any,\n  videoResize: PropTypes.bool,\n  scrollParallax: PropTypes.object,\n  show: PropTypes.bool,\n  componentProps: PropTypes.object\n};\n\nBgElement.defaultProps = {\n  component: 'div',\n  videoResize: true,\n  componentProps: {}\n};\n\nBgElement.isBannerAnimBgElement = true;"]},"metadata":{},"sourceType":"module"}